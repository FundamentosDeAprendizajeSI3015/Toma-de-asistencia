{% extends 'attendance/base.html' %}

{% block title %}Tomar Asistencia - {{ today|date:"d/m/Y" }}{% endblock %}

{% block content %}
<div class="attendance-page">
    <div class="page-header">
        <div class="date-info">
            <h2 class="page-title">Asistencia del dÃ­a</h2>
            <p class="current-date">ðŸ“… {{ today|date:"l, d \d\e F \d\e Y" }}</p>
        </div>
        <div class="stats-summary">
            <div class="stat-card present">
                <span class="stat-number" id="presentCount">{{ present_count }}</span>
                <span class="stat-label">Presentes</span>
            </div>
            <div class="stat-card absent">
                <span class="stat-number" id="absentCount">{{ absent_count }}</span>
                <span class="stat-label">Ausentes</span>
            </div>
            <div class="stat-card total">
                <span class="stat-number">{{ total_students }}</span>
                <span class="stat-label">Total</span>
            </div>
        </div>
    </div>

    <div class="actions-bar">
        <div class="bulk-actions">
            <button class="btn btn-secondary" id="selectAll">âœ“ Marcar todos</button>
            <button class="btn btn-secondary" id="deselectAll">âœ— Desmarcar todos</button>
        </div>
        <button class="btn btn-primary" id="saveAttendance">
            <span class="btn-text">ðŸ’¾ Guardar Asistencia</span>
            <span class="btn-loading" style="display: none;">Guardando...</span>
        </button>
    </div>

    <div class="students-grid" id="studentsGrid">
        {% for item in students_data %}
        <div class="student-card" data-student-id="{{ item.student.id }}">
            <label class="student-checkbox-label">
                <input type="checkbox" class="student-checkbox" data-student-id="{{ item.student.id }}" {{
                    item.is_present|yesno:"checked," }}>
                <span class="checkbox-custom"></span>
                <div class="student-info">
                    <span class="student-name">{{ item.student.full_name }}</span>
                    {% if item.student.email %}<span class="student-email">{{ item.student.email }}</span>{% endif %}
                </div>
            </label>
        </div>
        {% empty %}
        <div class="empty-state">
            <p>No hay estudiantes registrados.</p>
            <p>Agrega estudiantes desde el <a href="/admin/">panel de administraciÃ³n</a>.</p>
        </div>
        {% endfor %}
    </div>

    <div class="toast" id="toast">
        <span class="toast-message"></span>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    const TOTAL_STUDENTS = {{ total_students }};
</script>
{% endblock %}